<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive State Table to Diagram Converter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f2f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table-section h2, .diagram-section h2 {
            margin-bottom: 20px;
            color: #444;
        }

        /* State Table Styles */
        #stateTable {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        #stateTable th, #stateTable td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        #stateTable th {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }

        #stateTable tr {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #stateTable tr:hover {
            background-color: #f5f5f5;
        }

        #stateTable tr.highlighted {
            background-color: #ffeb3b !important;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* State Diagram SVG */
        #stateDiagram {
            width: 100%;
            height: 400px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #2196F3;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #1976D2;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        button.active {
            background-color: #4CAF50;
        }

        /* Info Box */
        .info-box {
            background-color: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .info-box h3 {
            margin-bottom: 10px;
            color: #1976D2;
        }

        /* State transition animation */
        .state-circle {
            transition: all 0.3s ease;
        }

        .state-circle.active {
            filter: drop-shadow(0 0 20px rgba(33, 150, 243, 0.8));
        }

        .transition-path {
            stroke-dasharray: 5, 5;
            animation: dash 1s linear infinite;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .transition-path.active {
            opacity: 1;
        }

        @keyframes dash {
            to {
                stroke-dashoffset: -10;
            }
        }

        /* Legend */
        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #333;
        }

        /* Tutorial Mode */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            z-index: 1000;
        }

        .tutorial-box {
            position: absolute;
            background: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .tutorial-box h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .tutorial-box button {
            margin-top: 10px;
        }

        /* Responsive */
        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔄 Μετατροπή Πίνακα Καταστάσεων σε Διάγραμμα Καταστάσεων</h1>
        
        <div class="controls">
            <button onclick="startTutorial()">📚 Tutorial Mode</button>
            <button onclick="animateAllTransitions()">▶️ Animate All</button>
            <button onclick="clearHighlights()">🔄 Clear</button>
            <button onclick="toggleAutoMode()" id="autoModeBtn">🤖 Auto Mode: OFF</button>
        </div>

        <div class="info-box">
            <h3>💡 Οδηγίες:</h3>
            <p>Κάντε κλικ σε μια γραμμή του πίνακα για να δείτε πώς μεταφράζεται σε μετάβαση στο διάγραμμα!</p>
        </div>

        <div class="main-content">
            <div class="section table-section">
                <h2>📊 Πίνακας Καταστάσεων</h2>
                <table id="stateTable">
                    <thead>
                        <tr>
                            <th>Παρούσα A</th>
                            <th>Παρούσα B</th>
                            <th>Κατάσταση</th>
                            <th>Είσοδος X</th>
                            <th>Επόμενη A+</th>
                            <th>Επόμενη B+</th>
                            <th>Επόμενη Κατάσταση</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Table rows will be generated by JavaScript -->
                    </tbody>
                </table>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-circle" style="background-color: #4CAF50;"></div>
                        <span>S0 (00) - Αρχική</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-circle" style="background-color: #2196F3;"></div>
                        <span>S1 (01) - '1' βρέθηκε</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-circle" style="background-color: #FF9800;"></div>
                        <span>S2 (10) - '10' βρέθηκε</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-circle" style="background-color: #9C27B0;"></div>
                        <span>S3 (11) - '101' βρέθηκε!</span>
                    </div>
                </div>
            </div>

            <div class="section diagram-section">
                <h2>📈 Διάγραμμα Καταστάσεων</h2>
                <svg id="stateDiagram" viewBox="0 0 600 400">
                    <!-- Arrow marker definition -->
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                                refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
                        </marker>
                    </defs>
                    
                    <!-- States -->
                    <g id="states">
                        <!-- S0 -->
                        <g id="state-S0">
                            <circle cx="150" cy="200" r="40" fill="#4CAF50" stroke="#333" 
                                    stroke-width="2" class="state-circle"/>
                            <text x="150" y="195" text-anchor="middle" font-size="14" 
                                  font-weight="bold" fill="white">S0</text>
                            <text x="150" y="210" text-anchor="middle" font-size="12" fill="white">(00)</text>
                        </g>
                        
                        <!-- S1 -->
                        <g id="state-S1">
                            <circle cx="450" cy="100" r="40" fill="#2196F3" stroke="#333" 
                                    stroke-width="2" class="state-circle"/>
                            <text x="450" y="95" text-anchor="middle" font-size="14" 
                                  font-weight="bold" fill="white">S1</text>
                            <text x="450" y="110" text-anchor="middle" font-size="12" fill="white">(01)</text>
                        </g>
                        
                        <!-- S2 -->
                        <g id="state-S2">
                            <circle cx="450" cy="300" r="40" fill="#FF9800" stroke="#333" 
                                    stroke-width="2" class="state-circle"/>
                            <text x="450" y="295" text-anchor="middle" font-size="14" 
                                  font-weight="bold" fill="white">S2</text>
                            <text x="450" y="310" text-anchor="middle" font-size="12" fill="white">(10)</text>
                        </g>
                        
                        <!-- S3 -->
                        <g id="state-S3">
                            <circle cx="300" cy="200" r="40" fill="#9C27B0" stroke="#333" 
                                    stroke-width="2" class="state-circle"/>
                            <text x="300" y="195" text-anchor="middle" font-size="14" 
                                  font-weight="bold" fill="white">S3</text>
                            <text x="300" y="210" text-anchor="middle" font-size="12" fill="white">(11)</text>
                        </g>
                    </g>
                    
                    <!-- Transitions (initially hidden) -->
                    <g id="transitions">
                        <!-- These will be drawn by JavaScript -->
                    </g>
                    
                    <!-- Initial state arrow -->
                    <path d="M 50 200 L 105 200" stroke="#333" stroke-width="2" 
                          marker-end="url(#arrowhead)" fill="none"/>
                    <text x="30" y="195" font-size="12">Start</text>
                </svg>
            </div>
        </div>

        <!-- Tutorial Overlay -->
        <div class="tutorial-overlay" id="tutorialOverlay">
            <div class="tutorial-box" id="tutorialBox">
                <h3 id="tutorialTitle">Welcome to the Tutorial!</h3>
                <p id="tutorialText">Let's learn how to convert a state table to a state diagram.</p>
                <button onclick="nextTutorialStep()">Next →</button>
                <button onclick="endTutorial()">Skip</button>
            </div>
        </div>
    </div>

    <script>
        // State table data
        const stateTableData = [
            {A: 0, B: 0, state: 'S0', X: 0, nextA: 0, nextB: 0, nextState: 'S0'},
            {A: 0, B: 0, state: 'S0', X: 1, nextA: 0, nextB: 1, nextState: 'S1'},
            {A: 0, B: 1, state: 'S1', X: 0, nextA: 1, nextB: 0, nextState: 'S2'},
            {A: 0, B: 1, state: 'S1', X: 1, nextA: 0, nextB: 1, nextState: 'S1'},
            {A: 1, B: 0, state: 'S2', X: 0, nextA: 0, nextB: 0, nextState: 'S0'},
            {A: 1, B: 0, state: 'S2', X: 1, nextA: 1, nextB: 1, nextState: 'S3'},
            {A: 1, B: 1, state: 'S3', X: 0, nextA: 0, nextB: 0, nextState: 'S0'},
            {A: 1, B: 1, state: 'S3', X: 1, nextA: 0, nextB: 1, nextState: 'S1'}
        ];

        // State positions for drawing
        const statePositions = {
            'S0': {x: 150, y: 200},
            'S1': {x: 450, y: 100},
            'S2': {x: 450, y: 300},
            'S3': {x: 300, y: 200}
        };

        // Auto mode variables
        let autoMode = false;
        let autoModeInterval = null;
        let currentAutoIndex = 0;

        // Initialize the application
        function init() {
            populateTable();
            drawAllTransitions();
        }

        // Populate the state table
        function populateTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            stateTableData.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.A}</td>
                    <td>${row.B}</td>
                    <td><strong>${row.state}</strong></td>
                    <td>${row.X}</td>
                    <td>${row.nextA}</td>
                    <td>${row.nextB}</td>
                    <td><strong>${row.nextState}</strong></td>
                `;
                tr.onclick = () => highlightTransition(index);
                tbody.appendChild(tr);
            });
        }

        // Draw all transitions on the diagram
        function drawAllTransitions() {
            const svg = document.getElementById('transitions');
            svg.innerHTML = '';
            
            // Group transitions by from-to states
            const transitionGroups = {};
            stateTableData.forEach((row, index) => {
                const key = `${row.state}-${row.nextState}`;
                if (!transitionGroups[key]) {
                    transitionGroups[key] = [];
                }
                transitionGroups[key].push({...row, index});
            });
            
            // Draw each unique transition
            Object.keys(transitionGroups).forEach(key => {
                const [from, to] = key.split('-');
                const transitions = transitionGroups[key];
                
                transitions.forEach((transition, i) => {
                    drawTransition(from, to, transition.X, transition.index, i);
                });
            });
        }

        // Draw a single transition
        function drawTransition(from, to, input, index, offset = 0) {
            const svg = document.getElementById('transitions');
            const fromPos = statePositions[from];
            const toPos = statePositions[to];
            
            // Create transition group
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            g.setAttribute('id', `transition-${index}`);
            g.setAttribute('class', 'transition-group');
            
            let path, labelX, labelY;
            
            if (from === to) {
                // Self-loop
                const loopOffset = offset * 30;
                path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const d = `M ${fromPos.x - 30} ${fromPos.y - 30} 
                          Q ${fromPos.x - 60 - loopOffset} ${fromPos.y - 60} 
                          ${fromPos.x} ${fromPos.y - 40}`;
                path.setAttribute('d', d);
                labelX = fromPos.x - 50 - loopOffset;
                labelY = fromPos.y - 50;
            } else {
                // Regular transition
                const angle = Math.atan2(toPos.y - fromPos.y, toPos.x - fromPos.x);
                const fromX = fromPos.x + 40 * Math.cos(angle);
                const fromY = fromPos.y + 40 * Math.sin(angle);
                const toX = toPos.x - 40 * Math.cos(angle);
                const toY = toPos.y - 40 * Math.sin(angle);
                
                // Add curve for multiple transitions
                const curveOffset = offset * 30;
                const midX = (fromX + toX) / 2 + curveOffset * Math.sin(angle);
                const midY = (fromY + toY) / 2 - curveOffset * Math.cos(angle);
                
                path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', `M ${fromX} ${fromY} Q ${midX} ${midY} ${toX} ${toY}`);
                
                labelX = midX;
                labelY = midY - 10;
            }
            
            path.setAttribute('fill', 'none');
            path.setAttribute('stroke', '#666');
            path.setAttribute('stroke-width', '2');
            path.setAttribute('marker-end', 'url(#arrowhead)');
            path.setAttribute('class', 'transition-path');
            
            // Add label
            const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('x', labelX);
            label.setAttribute('y', labelY);
            label.setAttribute('text-anchor', 'middle');
            label.setAttribute('font-size', '12');
            label.setAttribute('fill', '#333');
            label.setAttribute('font-weight', 'bold');
            label.textContent = `X=${input}`;
            
            // Add background for label
            const labelBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            const bbox = label.getBBox ? label.getBBox() : {width: 30, height: 15};
            labelBg.setAttribute('x', labelX - 15);
            labelBg.setAttribute('y', labelY - 12);
            labelBg.setAttribute('width', '30');
            labelBg.setAttribute('height', '15');
            labelBg.setAttribute('fill', 'white');
            labelBg.setAttribute('rx', '3');
            
            g.appendChild(path);
            g.appendChild(labelBg);
            g.appendChild(label);
            svg.appendChild(g);
        }

        // Highlight a specific transition
        function highlightTransition(index) {
            clearHighlights();
            
            // Highlight table row
            const rows = document.querySelectorAll('#tableBody tr');
            rows[index].classList.add('highlighted');
            
            // Highlight states
            const row = stateTableData[index];
            const fromState = document.querySelector(`#state-${row.state} circle`);
            const toState = document.querySelector(`#state-${row.nextState} circle`);
            
            if (fromState) fromState.classList.add('active');
            if (toState) toState.classList.add('active');
            
            // Show transition
            const transition = document.querySelector(`#transition-${index} path`);
            if (transition) {
                transition.classList.add('active');
                transition.style.stroke = '#2196F3';
                transition.style.strokeWidth = '3';
            }
            
            // Update info box
            updateInfoBox(row);
        }

        // Clear all highlights
        function clearHighlights() {
            document.querySelectorAll('#tableBody tr').forEach(tr => {
                tr.classList.remove('highlighted');
            });
            
            document.querySelectorAll('.state-circle').forEach(circle => {
                circle.classList.remove('active');
            });
            
            document.querySelectorAll('.transition-path').forEach(path => {
                path.classList.remove('active');
                path.style.stroke = '#666';
                path.style.strokeWidth = '2';
            });
        }

        // Update info box with transition details
        function updateInfoBox(row) {
            const infoBox = document.querySelector('.info-box');
            infoBox.innerHTML = `
                <h3>🎯 Μετάβαση που επιλέχθηκε:</h3>
                <p><strong>Από κατάσταση:</strong> ${row.state} (${row.A}${row.B})</p>
                <p><strong>Με είσοδο:</strong> X = ${row.X}</p>
                <p><strong>Σε κατάσταση:</strong> ${row.nextState} (${row.nextA}${row.nextB})</p>
                <p><strong>Σημασία:</strong> ${getTransitionMeaning(row)}</p>
            `;
        }

        // Get meaning of transition
        function getTransitionMeaning(row) {
            const meanings = {
                'S0-S0-0': 'Παραμονή στην αρχική κατάσταση (δεν ξεκίνησε η ακολουθία)',
                'S0-S1-1': 'Βρέθηκε το πρώτο "1" - ξεκινά η ακολουθία',
                'S1-S2-0': 'Βρέθηκε το "0" μετά το "1" - έχουμε "10"',
                'S1-S1-1': 'Νέο "1" - επανεκκίνηση της ακολουθίας',
                'S2-S0-0': 'Λάθος bit - επιστροφή στην αρχή',
                'S2-S3-1': '✅ Βρέθηκε η πλήρης ακολουθία "101"!',
                'S3-S0-0': 'Μετά την ανίχνευση, επιστροφή στην αρχή',
                'S3-S1-1': 'Μετά την ανίχνευση, νέο "1" - νέα αναζήτηση'
            };
            
            const key = `${row.state}-${row.nextState}-${row.X}`;
            return meanings[key] || 'Μετάβαση';
        }

        // Animate all transitions in sequence
        function animateAllTransitions() {
            let index = 0;
            clearHighlights();
            
            const interval = setInterval(() => {
                if (index >= stateTableData.length) {
                    clearInterval(interval);
                    clearHighlights();
                    return;
                }
                
                highlightTransition(index);
                index++;
            }, 1500);
        }

        // Toggle auto mode
        function toggleAutoMode() {
            autoMode = !autoMode;
            const btn = document.getElementById('autoModeBtn');
            
            if (autoMode) {
                btn.textContent = '🤖 Auto Mode: ON';
                btn.classList.add('active');
                startAutoMode();
            } else {
                btn.textContent = '🤖 Auto Mode: OFF';
                btn.classList.remove('active');
                stopAutoMode();
            }
        }

        // Start auto mode
        function startAutoMode() {
            currentAutoIndex = 0;
            autoModeInterval = setInterval(() => {
                highlightTransition(currentAutoIndex);
                currentAutoIndex = (currentAutoIndex + 1) % stateTableData.length;
            }, 2000);
        }

        // Stop auto mode
        function stopAutoMode() {
            if (autoModeInterval) {
                clearInterval(autoModeInterval);
                autoModeInterval = null;
            }
            clearHighlights();
        }

        // Tutorial functionality
        let tutorialStep = 0;
        const tutorialSteps = [
            {
                title: 'Καλώς ήρθατε στο Tutorial!',
                text: 'Θα μάθουμε πώς μετατρέπουμε έναν πίνακα καταστάσεων σε διάγραμμα.',
                highlight: null
            },
            {
                title: 'Βήμα 1: Ο Πίνακας Καταστάσεων',
                text: 'Κάθε γραμμή του πίνακα δείχνει μια μετάβαση. Οι στήλες A,B δείχνουν την τρέχουσα κατάσταση.',
                highlight: 'table'
            },
            {
                title: 'Βήμα 2: Αντιστοίχιση Καταστάσεων',
                text: 'AB=00 → S0, AB=01 → S1, AB=10 → S2, AB=11 → S3',
                highlight: 'states'
            },
            {
                title: 'Βήμα 3: Ανάγνωση Μετάβασης',
                text: 'Για κάθε γραμμή: Βλέπουμε την τρέχουσα κατάσταση (A,B), την είσοδο X, και την επόμενη κατάσταση (A+,B+).',
                highlight: 'row0'
            },
            {
                title: 'Βήμα 4: Σχεδίαση στο Διάγραμμα',
                text: 'Η μετάβαση σχεδιάζεται ως βέλος από την τρέχουσα στην επόμενη κατάσταση με ετικέτα την είσοδο X.',
                highlight: 'transition0'
            },
            {
                title: 'Ολοκλήρωση!',
                text: 'Τώρα μπορείτε να κάνετε κλικ σε οποιαδήποτε γραμμή για να δείτε την αντίστοιχη μετάβαση!',
                highlight: null
            }
        ];

        function startTutorial() {
            tutorialStep = 0;
            document.getElementById('tutorialOverlay').style.display = 'block';
            showTutorialStep();
        }

        function showTutorialStep() {
            const step = tutorialSteps[tutorialStep];
            document.getElementById('tutorialTitle').textContent = step.title;
            document.getElementById('tutorialText').textContent = step.text;
            
            // Position tutorial box
            const box = document.getElementById('tutorialBox');
            box.style.top = '50%';
            box.style.left = '50%';
            box.style.transform = 'translate(-50%, -50%)';
            
            // Apply highlights
            clearHighlights();
            if (step.highlight === 'row0') {
                highlightTransition(0);
            }
        }

        function nextTutorialStep() {
            tutorialStep++;
            if (tutorialStep >= tutorialSteps.length) {
                endTutorial();
            } else {
                showTutorialStep();
            }
        }

        function endTutorial() {
            document.getElementById('tutorialOverlay').style.display = 'none';
            clearHighlights();
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
