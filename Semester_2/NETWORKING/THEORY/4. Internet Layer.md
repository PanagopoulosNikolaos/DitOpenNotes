# Επίπεδο Δικτύου: Internet - Βασικές Αρχές και Λειτουργίες

Το επίπεδο διαδικτύου (Internet Layer) αποτελεί τον πυρήνα της λειτουργίας των σύγχρονων δικτύων, παρέχοντας τις θεμελιώδεις μεθόδους διευθυνσιοδότησης και δρομολόγησης πακέτων. Το πρωτόκολλο IP είναι το βασικό πρωτόκολλο που επιτρέπει την επικοινωνία μεταξύ διαφορετικών δικτύων και συσκευών.

## Αρχιτεκτονική Επιπέδων Δικτύου

```Mermaid
graph TD
    A[Επίπεδο Εφαρμογής] --> B[Επίπεδο Μεταφοράς - TCP]
    B --> C[Επίπεδο Διαδικτύου - IP]
    C --> D[Επίπεδο Πρόσβασης Δικτύου - Hardware Driver]
    style C fill:\#f96,stroke:#333,stroke-width:4px
```

## IP Διευθυνσιοδότηση

### Βασικές Έννοιες

- Μια IP διεύθυνση προσδιορίζει μοναδικά ένα δίκτυο ή έναν υπολογιστή (host)
- Ένα host μπορεί να έχει πολλά interfaces
- Μια IP διεύθυνση αποτελείται από δύο μέρη: **network ID** και **host ID**
- Η διάκριση των δύο μερών γίνεται με τη βοήθεια της **Μάσκας Υποδικτύου**

### Σύγκριση IPv4 και IPv6

|   |   |   |
|---|---|---|
|Χαρακτηριστικό|IPv4|IPv6|
|Μήκος διεύθυνσης|32 bits (4 bytes)|128 bits (16 bytes)|
|Μορφή|193.210.18.18|2001:0db8:85a3:0000:0000:8a2e:0370:7334|
|Αριθμός διευθύνσεων|Περίπου 4.3 δισεκατομμύρια|340 undecillion|

### Δομή Διεύθυνσης IPv4

```Mermaid
graph LR
    A[Network ID] --- B[Host ID]
    style A fill:\#bbf,stroke:#333,color:#000
    style B fill:\#fbf,stroke:#333,color:#000
```

## Δρομολόγηση Πακέτων IP

### Τρόπος Λειτουργίας του Internet

```Mermaid
graph TD
    A["Υπολογιστής"] -->|"1 Έλεγχος προορισμού"| B{"Ίδιο δίκτυο;"}
    B -->|"Ναι"| C["Απευθείας αποστολή μέσω ARP"]
    B -->|"Όχι"| D["Αποστολή στο Gateway"]
    D -->|"2 Δρομολόγηση hop-by-hop"| E["Gateway προορισμού"]
    E -->|"3 Παράδοση στον τελικό προορισμό"| F["Υπολογιστής προορισμού"]
```

### Διάγραμμα Δρομολόγησης Datagram

Ο τρόπος δρομολόγησης πακέτων εξαρτάται από τη θέση του προορισμού:

1. **Προορισμός στο ίδιο τοπικό δίκτυο:** Απευθείας αποστολή με ARP
2. **Προορισμός εκτός τοπικού δικτύου:** Αποστολή στο Gateway και hop-by-hop δρομολόγηση
3. **Τελική παράδοση:** Το Gateway του προορισμού χρησιμοποιεί ARP για παράδοση στον τελικό κόμβο

## Πρωτόκολλο ARP (Address Resolution Protocol)

### Λειτουργία ARP

Το πρωτόκολλο ARP χρησιμοποιείται όταν είναι γνωστή η IP διεύθυνση αλλά όχι η φυσική διεύθυνση (MAC) μιας συσκευής.

```Mermaid
sequenceDiagram
    participant A as Υπολ/στής A
    participant B as Υπολ/στής B
    A->>B: ARP Request: IP 192.168.1.5;
    Note over A,B: Broadcast μήνυμα
    B->>A: ARP Reply: MAC=AA:BB:CC:DD:EE:FF
    Note over A: Ενημέρωση πίνακα ARP
```

### Δομή Πίνακα ARP Cache

|   |   |
|---|---|
|IP Address|MAC Address|
|206.154.13.82|00-E0-98-07-8E-39|
|206.154.13.83|35-00-21-01-3B-14|
|206.154.13.84|44-45-53-54-00-00|
|206.154.13.85|91-03-20-51-09-26|

### Μορφή Πακέτου ARP

|   |   |   |
|---|---|---|
|Πεδίο|Μέγεθος (bytes)|Περιγραφή|
|Hardware type|2|Τύπος φυσικής διεύθυνσης (0x0001 = Ethernet)|
|Protocol type|2|Τύπος πρωτοκόλλου (0x800 = IP)|
|Hardware size|1|Μέγεθος φυσικής διεύθυνσης|
|Protocol size|1|Μέγεθος διεύθυνσης πρωτοκόλλου|
|Operation|2|ARP/RARP αίτημα/απάντηση|
|Sender MAC|6|MAC αποστολέα|
|Sender IP|4|IP αποστολέα|
|Target MAC|6|MAC παραλήπτη (ζητούμενο)|
|Target IP|4|IP παραλήπτη|

## Δομή του IP Datagram

### Επικεφαλίδα IP

```Plain
+--------+--------+--------+--------+
|Version | IHL    |Type of Service   |
+--------+--------+--------+--------+
|        Total Length             |
+--------+--------+--------+--------+
|        Identification           |
+--------+--------+--------+--------+
|Flags   |    Fragment Offset      |
+--------+--------+--------+--------+
|  Time to Live  |   Protocol      |
+--------+--------+--------+--------+
|        Header Checksum          |
+--------+--------+--------+--------+
|        Source Address           |
+--------+--------+--------+--------+
|      Destination Address        |
+--------+--------+--------+--------+
|   Options (αν υπάρχουν) + Padding |
+--------+--------+--------+--------+
|        Δεδομένα (Data Payload)     |
+--------+--------+--------+--------+
```

### Ανάλυση Πεδίων IP Επικεφαλίδας

|   |   |
|---|---|
|Πεδίο|Περιγραφή|
|Version|IP4 (0100) ή IP6 (0110)|
|IHL|Internet Header Length, ελάχιστο 5 (20 bytes)|
|Type of Service|Πληροφορίες δρομολόγησης, QoS|
|Total Length|Συνολικό μήκος του datagram σε bytes|
|Identification|Μοναδική ταυτότητα του datagram|
|Flags|Έλεγχος κατάτμησης|
|Fragment Offset|Για επανασύνθεση κατατμημένων πακέτων|
|Time to Live (TTL)|Χρόνος ζωής του πακέτου σε hops|
|Protocol|Πρωτόκολλο ανώτερου επιπέδου (TCP=6, UDP=17, ICMP=1)|
|Header Checksum|Έλεγχος εγκυρότητας επικεφαλίδας|
|Source Address|IP διεύθυνση αποστολέα|
|Destination Address|IP διεύθυνση παραλήπτη|
|Options|Πρόσθετες επιλογές (ασφάλεια, δρομολόγηση, κλπ.)|

## Κατηγορίες IP Διευθύνσεων

### Κλάσεις IP

|   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|
|Κλάση|Αρχικά bits|Δυαδικό εύρος|Δεκαδικό εύρος|Μέγιστα υποδίκτυα|Μέγιστοι hosts|Μάσκα δρομολόγησης|
|A|0|00000000-01111111|0-127*|127|16,777,214|255.0.0.0|
|B|10|10000000-10111111|128-191|16,384|65,534|255.255.0.0|
|C|110|11000000-11011111|192-223|2,097,152|254|255.255.255.0|
|D|1110|11100000-11101111|224-239|-|-|-|
|E|1111|11110000-11111111|240-255|-|-|-|

- Το 0 και το 127 έχουν ειδική χρήση.

### Δομή των Διαφορετικών Κλάσεων

```Mermaid
graph LR
    subgraph "Class A"
    A1[N: 1 byte] --- A2[H: 3 bytes]
    end

    subgraph "Class B"
    B1[N: 2 bytes] --- B2[H: 2 bytes]
    end

    subgraph "Class C"
    C1[N: 3 bytes] --- C2[H: 1 byte]
    end

    style A1 fill:\#bbf,stroke:#333,fill: #000
    style A2 fill:\#fbf,stroke:#333,fill: #000
    style B1 fill:\#bbf,stroke:#333,fill: #000
    style B2 fill:\#fbf,stroke:#333,fill: #000
    style C1 fill:\#bbf,stroke:#333,fill: #000
    style C2 fill:\#fbf,stroke:#333,fill: #000
   
```

### Ειδικές Διευθύνσεις

|   |   |
|---|---|
|Διεύθυνση|Χρήση|
|0.0.0.0|Χρησιμοποιείται για "κάθε" ή "όχι" IP διεύθυνση|
|255.255.255.255|Τοπική broadcast διεύθυνση|
|127.0.0.1|Loopback διεύθυνση (localhost)|
|NetID.0.0.0|Διεύθυνση δικτύου|
|NetID.255.255.255|Broadcast διεύθυνση δικτύου|

### Ιδιωτικές Διευθύνσεις (NAT)

- 10.0.0.0/8
- 192.168.0.0/16
- 172.16.0.0/12

## Πρωτόκολλο ICMP

### Τύποι Μηνυμάτων ICMP

|   |   |   |
|---|---|---|
|Τύπος Μηνύματος|Περιγραφή|Χρήση|
|Echo Request/Reply|Αίτημα και απάντηση ηχούς|Για έλεγχο συνδεσιμότητας (ping)|
|Source Quench|Έλεγχος ροής|Συγχρονισμός γρήγορων H/Y με αργούς δρομολογητές|
|Destination Unreachable|Αδυναμία παράδοσης|Όταν ένας δρομολογητής δεν μπορεί να παραδώσει ένα datagram|
|Time Exceeded|Υπέρβαση χρόνου|Όταν ο χρόνος TTL μηδενίζεται|
|Fragmentation Needed|Ανάγκη κατάτμησης|Όταν απαιτείται κατάτμηση του datagram|

### Δομή Πακέτου ICMP

```Plain
+--------+--------+--------+--------+
|  Type  |  Code  |   Checksum      |
+--------+--------+--------+--------+
|       Data (περιεχόμενο)         |
+--------+--------+--------+--------+
```

## Μετατροπή Δυαδικής-Δεκαδικής Μορφής

### Από Δυαδικό σε Δεκαδικό

|   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|
|2⁷|2⁶|2⁵|2⁴|2³|2²|2¹|2⁰|
|128|64|32|16|8|4|2|1|

Παράδειγμα: 10110111 = 128 + 32 + 16 + 4 + 2 + 1 = 183

### Από Δεκαδικό σε Δυαδικό

Μέθοδος διαδοχικών διαιρέσεων με το 2:

```Plain
Αριθμός: 207
207 ÷ 2 = 103 υπόλοιπο 1
103 ÷ 2 = 51  υπόλοιπο 1
51  ÷ 2 = 25  υπόλοιπο 1
25  ÷ 2 = 12  υπόλοιπο 1
12  ÷ 2 = 6   υπόλοιπο 0
6   ÷ 2 = 3   υπόλοιπο 0
3   ÷ 2 = 1   υπόλοιπο 1
1   ÷ 2 = 0   υπόλοιπο 1
```

Απάντηση: 11001111

## Πρακτικές Εφαρμογές και Ερωτήσεις

### Ερωτήσεις Για Εξάσκηση

1. Το πρωτόκολλο ARP τι είδους πληροφορίες επιστρέφει όταν λαμβάνει μια IP address;  
    **Απάντηση**: Επιστρέφει τη φυσική διεύθυνση (MAC address) που αντιστοιχεί στην IP address.
2. Ένας δρομολογητής δεν μπορεί να παρακολουθήσει τον όγκο της κίνησης, τι είδους ICMP μηνύματος στέλνει;  
    **Απάντηση**: Στέλνει μήνυμα "Source Quench".
3. Σε ποια Κλάση ανήκει η IP διεύθυνση που ξεκινά με τον δυαδικό 110 στα τρία πιο αριστερά ψηφία;  
    **Απάντηση**: Ανήκει στην Κλάση C.
4. Μετατρέψτε τους δυαδικούς αριθμούς:
    - 00101011 = 43
    - 01010010 = 82
5. Μετατρέψτε τους δεκαδικούς αριθμούς:
    - 184 = 10111000
    - 37 = 00100101

### Παράδειγμα Τοπικού Δικτύου

```Mermaid
graph TD
    R[Router Gateway] --- S[Switch]
    S --- A[PC A: 192.168.1.10]
    S --- B[PC B: 192.168.1.11]
    S --- C[PC C: 192.168.1.12]
    S --- P[Printer: 192.168.1.50]
    R --- I[Internet]
```

### Παράδειγμα Διαδικασίας ARP

1. Ο υπολογιστής A θέλει να επικοινωνήσει με τον υπολογιστή C
2. Ελέγχει τον πίνακα ARP για την MAC address του C
3. Αν δεν τη βρει, στέλνει ARP broadcast ερώτημα: "Ποιος έχει την IP 192.168.1.12;"
4. Ο υπολογιστής C απαντά με την MAC address του
5. Ο υπολογιστής A αποθηκεύει την αντιστοιχία στον πίνακα ARP
6. Η επικοινωνία ξεκινά